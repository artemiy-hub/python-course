# –¢–µ–æ—Ä–∏—è: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –≤ Python

## üéØ –¶–µ–ª—å —Ä–∞–∑–¥–µ–ª–∞

–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª —É–≥–ª—É–±–ª—è–µ—Ç—Å—è –≤ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –∞—Å–ø–µ–∫—Ç—ã —Å–∏—Å—Ç–µ–º—ã —Ç–∏–ø–æ–≤ Python, –≤–∫–ª—é—á–∞—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏, –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–∏–ø–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö, –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤](#–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ-–∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏-—Ç–∏–ø–æ–≤)
2. [Dataclasses –∏ —Ç–∏–ø–∏–∑–∞—Ü–∏—è](#dataclasses-–∏-—Ç–∏–ø–∏–∑–∞—Ü–∏—è)
3. [–ü—Ä–æ—Ç–æ–∫–æ–ª—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è](#–ø—Ä–æ—Ç–æ–∫–æ–ª—ã-–∏-—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞—è-—Ç–∏–ø–∏–∑–∞—Ü–∏—è)
4. [–û–±–æ–±—â–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö](#–æ–±–æ–±—â–µ–Ω–Ω—ã–µ-—Ç–∏–ø—ã-–≤-—Ä–µ–∞–ª—å–Ω—ã—Ö-–ø—Ä–æ–µ–∫—Ç–∞—Ö)
5. [–¢–∏–ø–∏–∑–∞—Ü–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞](#—Ç–∏–ø–∏–∑–∞—Ü–∏—è-–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ-–∫–æ–¥–∞)
6. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å IDE –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-—Å-ide-–∏-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏)
7. [–ú–∏–≥—Ä–∞—Ü–∏—è –∫ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏](#–º–∏–≥—Ä–∞—Ü–∏—è-–∫-—Ç–∏–ø–∏–∑–∞—Ü–∏–∏)

---

## üöÄ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤

### TypeVar —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ –∏ —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ–º

```python
from typing import TypeVar, Protocol, Union, overload
from abc import abstractmethod

# –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π TypeVar
Number = TypeVar('Number', int, float, complex)

def add_numbers(a: Number, b: Number) -> Number:
    """–°–ª–æ–∂–µ–Ω–∏–µ —á–∏—Å–µ–ª —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ç–∏–ø–∞"""
    return a + b

# Bound TypeVar
class Comparable(Protocol):
    @abstractmethod
    def __lt__(self, other) -> bool: ...

T = TypeVar('T', bound=Comparable)

def sort_items(items: list[T]) -> list[T]:
    """–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Å—Ä–∞–≤–Ω–∏–º—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤"""
    return sorted(items)

# Variance –≤ —Ç–∏–ø–∞—Ö
from typing import TypeVar, Generic, Callable

T_co = TypeVar('T_co', covariant=True)  # –ö–æ–≤–∞—Ä–∏–∞–Ω—Ç–Ω—ã–π
T_contra = TypeVar('T_contra', contravariant=True)  # –ö–æ–Ω—Ç—Ä–≤–∞—Ä–∏–∞–Ω—Ç–Ω—ã–π

class Producer(Generic[T_co]):
    """–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç T)"""
    def produce(self) -> T_co: ...

class Consumer(Generic[T_contra]):
    """–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç T)"""
    def consume(self, item: T_contra) -> None: ...
```

### –£—Å–ª–æ–≤–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –∏ Type Guards

```python
from typing import TypeGuard, Union, Any, cast
import sys

def is_string_list(val: list[Any]) -> TypeGuard[list[str]]:
    """Type guard –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–ø–∏—Å–∫–∞ —Å—Ç—Ä–æ–∫"""
    return all(isinstance(x, str) for x in val)

def process_strings(items: list[Any]) -> None:
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ç–∏–ø–æ–≤"""
    if is_string_list(items):
        # –¢–µ–ø–µ—Ä—å mypy –∑–Ω–∞–µ—Ç, —á—Ç–æ items: list[str]
        for item in items:
            print(item.upper())  # –ë–µ–∑–æ–ø–∞—Å–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã

# –£—Å–ª–æ–≤–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–µ—Ä—Å–∏–∏ Python
if sys.version_info >= (3, 10):
    from typing import TypeAlias
    JSONValue: TypeAlias = Union[str, int, float, bool, None, 
                                dict[str, 'JSONValue'], 
                                list['JSONValue']]
else:
    from typing import Dict, List
    JSONValue = Union[str, int, float, bool, None, 
                     Dict[str, 'JSONValue'], 
                     List['JSONValue']]

# –ü—Ä—è–º–∞—è –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è (Forward Reference)
class Node:
    def __init__(self, value: int, parent: 'Node | None' = None):
        self.value = value
        self.parent = parent
        self.children: list['Node'] = []
```

### Literal —Ç–∏–ø—ã –∏ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è

```python
from typing import Literal, Union
from enum import Enum, auto

# Literal —Ç–∏–ø—ã –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
LogLevel = Literal["DEBUG", "INFO", "WARNING", "ERROR", "CRITICAL"]
HttpMethod = Literal["GET", "POST", "PUT", "DELETE", "PATCH"]

def make_request(method: HttpMethod, url: str) -> dict[str, Any]:
    """HTTP –∑–∞–ø—Ä–æ—Å —Å —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –º–µ—Ç–æ–¥–æ–º"""
    ...

# –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ Literal —Å Enum
class Status(Enum):
    PENDING = auto()
    PROCESSING = auto()
    COMPLETED = auto()
    FAILED = auto()

StatusLiteral = Literal[Status.PENDING, Status.PROCESSING, 
                       Status.COMPLETED, Status.FAILED]

# Literal –¥–ª—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è API
APIVersion = Literal["v1", "v2", "v3"]

def handle_api_request(version: APIVersion, data: dict) -> dict:
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ API –∑–∞–ø—Ä–æ—Å–∞ —Å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º"""
    if version == "v1":
        return handle_v1(data)
    elif version == "v2":
        return handle_v2(data)
    elif version == "v3":
        return handle_v3(data)
```

---

## üì¶ Dataclasses –∏ —Ç–∏–ø–∏–∑–∞—Ü–∏—è

### –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ dataclasses

```python
from dataclasses import dataclass, field, InitVar, asdict, astuple
from typing import ClassVar, Optional, Any, Dict, List
from datetime import datetime
import json

@dataclass(frozen=True, order=True)
class Point:
    """–ù–µ–∏–∑–º–µ–Ω—è–µ–º–∞—è —Ç–æ—á–∫–∞ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Å—Ä–∞–≤–Ω–µ–Ω–∏—è"""
    x: float
    y: float
    z: float = 0.0
    
    def distance_to(self, other: 'Point') -> float:
        """–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –¥—Ä—É–≥–æ–π —Ç–æ—á–∫–∏"""
        return ((self.x - other.x) ** 2 + 
                (self.y - other.y) ** 2 + 
                (self.z - other.z) ** 2) ** 0.5

@dataclass
class User:
    """–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏"""
    
    # –û–±—ã—á–Ω—ã–µ –ø–æ–ª—è
    id: int
    username: str
    email: str
    
    # –ü–æ–ª—è —Å –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    is_active: bool = True
    created_at: datetime = field(default_factory=datetime.now)
    
    # –ü–æ–ª—è, –∏—Å–∫–ª—é—á–µ–Ω–Ω—ã–µ –∏–∑ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
    password_hash: str = field(repr=False, compare=False)
    login_count: int = field(default=0, compare=False)
    
    # –ü–æ–ª—è —Å —Ñ–∞–±—Ä–∏—á–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏
    tags: List[str] = field(default_factory=list)
    metadata: Dict[str, Any] = field(default_factory=dict)
    
    # –ö–ª–∞—Å—Å–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    _instances: ClassVar[Dict[int, 'User']] = {}
    
    # InitVar –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    initial_password: InitVar[Optional[str]] = None
    
    def __post_init__(self, initial_password: Optional[str]):
        """–ü–æ—Å—Ç-–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π"""
        if not self.username or len(self.username) < 3:
            raise ValueError("Username –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞")
        
        if "@" not in self.email:
            raise ValueError("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email")
        
        if initial_password:
            self.password_hash = self._hash_password(initial_password)
        
        # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        User._instances[self.id] = self
    
    @staticmethod
    def _hash_password(password: str) -> str:
        """–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª—è (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)"""
        import hashlib
        return hashlib.sha256(password.encode()).hexdigest()
    
    def to_dict(self) -> Dict[str, Any]:
        """–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ —Å–ª–æ–≤–∞—Ä—å"""
        return asdict(self)
    
    def to_json(self) -> str:
        """–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ JSON"""
        data = self.to_dict()
        # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º datetime –≤ ISO —Ñ–æ—Ä–º–∞—Ç
        data['created_at'] = self.created_at.isoformat()
        return json.dumps(data, ensure_ascii=False)
    
    @classmethod
    def from_dict(cls, data: Dict[str, Any]) -> 'User':
        """–î–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑ —Å–ª–æ–≤–∞—Ä—è"""
        if 'created_at' in data and isinstance(data['created_at'], str):
            data['created_at'] = datetime.fromisoformat(data['created_at'])
        return cls(**data)

# –ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ dataclasses
@dataclass
class AdminUser(User):
    """–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏"""
    
    permissions: List[str] = field(default_factory=list)
    super_admin: bool = False
    
    def __post_init__(self, initial_password: Optional[str]):
        """–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –ø–æ—Å—Ç-–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è"""
        super().__post_init__(initial_password)
        
        # –î–æ–±–∞–≤–ª—è–µ–º –±–∞–∑–æ–≤—ã–µ –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
        if not self.permissions:
            self.permissions = ["read", "write", "delete"]

# Dataclass —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –º–µ—Ç–æ–¥–∞–º–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
@dataclass
class Version:
    """–í–µ—Ä—Å–∏—è —Å —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–º —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ–º"""
    major: int
    minor: int
    patch: int
    pre_release: Optional[str] = None
    
    def __str__(self) -> str:
        version = f"{self.major}.{self.minor}.{self.patch}"
        if self.pre_release:
            version += f"-{self.pre_release}"
        return version
    
    def __lt__(self, other: 'Version') -> bool:
        """–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π"""
        if not isinstance(other, Version):
            return NotImplemented
        
        # –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
        self_tuple = (self.major, self.minor, self.patch)
        other_tuple = (other.major, other.minor, other.patch)
        
        if self_tuple != other_tuple:
            return self_tuple < other_tuple
        
        # –ï—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ —Ä–∞–≤–Ω—ã, —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º pre-release
        if self.pre_release is None and other.pre_release is None:
            return False
        if self.pre_release is None:
            return False  # –†–µ–ª–∏–∑ –±–æ–ª—å—à–µ pre-release
        if other.pre_release is None:
            return True   # pre-release –º–µ–Ω—å—à–µ —Ä–µ–ª–∏–∑–∞
        
        return self.pre_release < other.pre_release
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Pydantic

```python
from typing import Optional, List, Dict, Any
from datetime import datetime
from pydantic import BaseModel, validator, Field
from enum import Enum

class UserRole(str, Enum):
    """–†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"""
    ADMIN = "admin"
    USER = "user"
    MODERATOR = "moderator"

class UserProfile(BaseModel):
    """–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π Pydantic"""
    
    id: int = Field(..., gt=0, description="–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä")
    username: str = Field(..., min_length=3, max_length=50, 
                         regex=r'^[a-zA-Z0-9_]+$')
    email: str = Field(..., regex=r'^[^@]+@[^@]+\.[^@]+$')
    full_name: str = Field(..., min_length=1, max_length=100)
    age: Optional[int] = Field(None, ge=13, le=120)
    role: UserRole = UserRole.USER
    tags: List[str] = Field(default_factory=list, max_items=10)
    metadata: Dict[str, Any] = Field(default_factory=dict)
    created_at: datetime = Field(default_factory=datetime.now)
    is_active: bool = True
    
    class Config:
        """–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–∏"""
        use_enum_values = True
        validate_assignment = True
        arbitrary_types_allowed = True
        schema_extra = {
            "example": {
                "id": 1,
                "username": "john_doe",
                "email": "john@example.com",
                "full_name": "John Doe",
                "age": 30,
                "role": "user",
                "tags": ["python", "developer"],
                "is_active": True
            }
        }
    
    @validator('username')
    def username_must_not_contain_spaces(cls, v):
        """–í–∞–ª–∏–¥–∞—Ü–∏—è username"""
        if ' ' in v:
            raise ValueError('Username –Ω–µ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–±–µ–ª—ã')
        return v.lower()
    
    @validator('tags')
    def validate_tags(cls, v):
        """–í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–≥–æ–≤"""
        if v:
            # –£–¥–∞–ª—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –∏ –ø—Ä–∏–≤–æ–¥–∏–º –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
            return list(set(tag.lower().strip() for tag in v if tag.strip()))
        return v
    
    @validator('full_name')
    def validate_full_name(cls, v):
        """–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª–Ω–æ–≥–æ –∏–º–µ–Ω–∏"""
        # –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
        return ' '.join(v.split())
    
    def is_admin(self) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"""
        return self.role == UserRole.ADMIN
    
    def add_tag(self, tag: str) -> None:
        """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–≥–∞"""
        if tag and tag.lower() not in self.tags:
            self.tags.append(tag.lower())
    
    def to_dict(self) -> Dict[str, Any]:
        """–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ —Å–ª–æ–≤–∞—Ä—å"""
        return self.dict()
    
    def to_json(self) -> str:
        """–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ JSON"""
        return self.json(ensure_ascii=False)
```

---

## üîó –ü—Ä–æ—Ç–æ–∫–æ–ª—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è

### –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã

```python
from typing import Protocol, runtime_checkable, TypeVar, Generic
from abc import abstractmethod

# –ë–∞–∑–æ–≤—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã
@runtime_checkable
class Drawable(Protocol):
    """–ü—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è —Ä–∏—Å—É–µ–º—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤"""
    
    def draw(self) -> str:
        """–ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç"""
        ...
    
    def get_bounds(self) -> tuple[float, float, float, float]:
        """–ü–æ–ª—É—á–∏—Ç—å –≥—Ä–∞–Ω–∏—Ü—ã –æ–±—ä–µ–∫—Ç–∞ (x, y, width, height)"""
        ...

@runtime_checkable
class Serializable(Protocol):
    """–ü—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ–º—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤"""
    
    def serialize(self) -> dict[str, Any]:
        """–°–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç"""
        ...
    
    @classmethod
    def deserialize(cls, data: dict[str, Any]) -> 'Serializable':
        """–î–µ—Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç"""
        ...

# –û–±–æ–±—â–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã
T = TypeVar('T')
K = TypeVar('K')
V = TypeVar('V')

class Container(Protocol, Generic[T]):
    """–ü—Ä–æ—Ç–æ–∫–æ–ª –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞"""
    
    def add(self, item: T) -> None:
        """–î–æ–±–∞–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç"""
        ...
    
    def remove(self, item: T) -> bool:
        """–£–¥–∞–ª–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç"""
        ...
    
    def __contains__(self, item: T) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞"""
        ...
    
    def __len__(self) -> int:
        """–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤"""
        ...

class Mapping(Protocol, Generic[K, V]):
    """–ü—Ä–æ—Ç–æ–∫–æ–ª –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è"""
    
    def __getitem__(self, key: K) -> V: ...
    def __setitem__(self, key: K, value: V) -> None: ...
    def __delitem__(self, key: K) -> None: ...
    def __contains__(self, key: K) -> bool: ...
    def keys(self) -> Iterator[K]: ...
    def values(self) -> Iterator[V]: ...
    def items(self) -> Iterator[tuple[K, V]]: ...

# –ü—Ä–æ—Ç–æ–∫–æ–ª —Å callback'–∞–º–∏
class EventHandler(Protocol):
    """–ü—Ä–æ—Ç–æ–∫–æ–ª –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Å–æ–±—ã—Ç–∏–π"""
    
    def handle_event(self, event_type: str, data: dict[str, Any]) -> None:
        """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ"""
        ...

class Observable(Protocol):
    """–ü—Ä–æ—Ç–æ–∫–æ–ª –Ω–∞–±–ª—é–¥–∞–µ–º–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞"""
    
    def add_handler(self, handler: EventHandler) -> None:
        """–î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫"""
        ...
    
    def remove_handler(self, handler: EventHandler) -> None:
        """–£–¥–∞–ª–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫"""
        ...
    
    def notify(self, event_type: str, data: dict[str, Any]) -> None:
        """–£–≤–µ–¥–æ–º–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏"""
        ...

# –ü—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–µ—Å—É—Ä—Å–∞–º–∏
class Resource(Protocol):
    """–ü—Ä–æ—Ç–æ–∫–æ–ª —Ä–µ—Å—É—Ä—Å–∞"""
    
    def acquire(self) -> None:
        """–ó–∞—Ö–≤–∞—Ç–∏—Ç—å —Ä–µ—Å—É—Ä—Å"""
        ...
    
    def release(self) -> None:
        """–û—Å–≤–æ–±–æ–¥–∏—Ç—å —Ä–µ—Å—É—Ä—Å"""
        ...
    
    def __enter__(self) -> 'Resource':
        """–í—Ö–æ–¥ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä"""
        ...
    
    def __exit__(self, exc_type, exc_val, exc_tb) -> None:
        """–í—ã—Ö–æ–¥ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞"""
        ...

# –ö–æ–º–ø–æ–∑–∏—Ü–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤
class DrawableSerializable(Drawable, Serializable, Protocol):
    """–û–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ —Ä–∏—Å–æ–≤–∞—Ç—å –∏ —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å"""
    pass

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
class Circle:
    """–ö—Ä—É–≥ - —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –Ω–µ—è–≤–Ω–æ"""
    
    def __init__(self, x: float, y: float, radius: float):
        self.x = x
        self.y = y
        self.radius = radius
    
    def draw(self) -> str:
        return f"–ö—Ä—É–≥ –≤ ({self.x}, {self.y}) —Ä–∞–¥–∏—É—Å–æ–º {self.radius}"
    
    def get_bounds(self) -> tuple[float, float, float, float]:
        return (self.x - self.radius, self.y - self.radius, 
                2 * self.radius, 2 * self.radius)
    
    def serialize(self) -> dict[str, Any]:
        return {
            "type": "circle",
            "x": self.x,
            "y": self.y,
            "radius": self.radius
        }
    
    @classmethod
    def deserialize(cls, data: dict[str, Any]) -> 'Circle':
        return cls(data["x"], data["y"], data["radius"])

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö
def render_objects(objects: list[Drawable]) -> list[str]:
    """–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –æ–±—ä–µ–∫—Ç–æ–≤"""
    return [obj.draw() for obj in objects]

def save_objects(objects: list[Serializable], filename: str) -> None:
    """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ —Ñ–∞–π–ª"""
    import json
    data = [obj.serialize() for obj in objects]
    with open(filename, 'w', encoding='utf-8') as f:
        json.dump(data, f, ensure_ascii=False, indent=2)

def process_container(container: Container[str], items: list[str]) -> None:
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞"""
    for item in items:
        container.add(item)
    
    print(f"–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç {len(container)} —ç–ª–µ–º–µ–Ω—Ç–æ–≤")
    
    if "test" in container:
        container.remove("test")
```

---

## üéØ –û–±–æ–±—â–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö

### –°–∏—Å—Ç–µ–º–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Å —Ç–∏–ø–∞–º–∏

```python
from typing import TypeVar, Generic, Optional, Dict, Any, Callable
from dataclasses import dataclass
from datetime import datetime, timedelta
import weakref
import threading
from abc import ABC, abstractmethod

K = TypeVar('K')  # –¢–∏–ø –∫–ª—é—á–∞
V = TypeVar('V')  # –¢–∏–ø –∑–Ω–∞—á–µ–Ω–∏—è

@dataclass(frozen=True)
class CacheEntry(Generic[V]):
    """–ó–∞–ø–∏—Å—å –≤ –∫—ç—à–µ"""
    value: V
    created_at: datetime
    expires_at: Optional[datetime] = None
    hit_count: int = 0
    
    def is_expired(self) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞"""
        if self.expires_at is None:
            return False
        return datetime.now() > self.expires_at
    
    def with_hit(self) -> 'CacheEntry[V]':
        """–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º —Å—á–µ—Ç—á–∏–∫–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–π"""
        return CacheEntry(
            value=self.value,
            created_at=self.created_at,
            expires_at=self.expires_at,
            hit_count=self.hit_count + 1
        )

class CacheStrategy(ABC, Generic[K, V]):
    """–ê–±—Å—Ç—Ä–∞–∫—Ç–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è"""
    
    @abstractmethod
    def should_evict(self, key: K, entry: CacheEntry[V], 
                    cache_size: int, max_size: int) -> bool:
        """–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —Å–ª–µ–¥—É–µ—Ç –ª–∏ —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å"""
        ...

class LRUStrategy(CacheStrategy[K, V]):
    """–°—Ç—Ä–∞—Ç–µ–≥–∏—è LRU (Least Recently Used)"""
    
    def __init__(self):
        self.access_times: Dict[K, datetime] = {}
    
    def should_evict(self, key: K, entry: CacheEntry[V], 
                    cache_size: int, max_size: int) -> bool:
        """LRU –ª–æ–≥–∏–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è"""
        if cache_size <= max_size:
            return False
        
        # –ù–∞—Ö–æ–¥–∏–º —Å–∞–º—É—é —Å—Ç–∞—Ä—É—é –∑–∞–ø–∏—Å—å
        oldest_key = min(self.access_times.keys(), 
                        key=lambda k: self.access_times[k])
        return key == oldest_key
    
    def record_access(self, key: K) -> None:
        """–ó–∞–ø–∏—Å–∞—Ç—å –≤—Ä–µ–º—è –¥–æ—Å—Ç—É–ø–∞"""
        self.access_times[key] = datetime.now()
    
    def remove_key(self, key: K) -> None:
        """–£–¥–∞–ª–∏—Ç—å –∫–ª—é—á –∏–∑ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è"""
        self.access_times.pop(key, None)

class TTLStrategy(CacheStrategy[K, V]):
    """–°—Ç—Ä–∞—Ç–µ–≥–∏—è TTL (Time To Live)"""
    
    def should_evict(self, key: K, entry: CacheEntry[V], 
                    cache_size: int, max_size: int) -> bool:
        """TTL –ª–æ–≥–∏–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è"""
        return entry.is_expired()

class Cache(Generic[K, V]):
    """–¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫—ç—à —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏"""
    
    def __init__(self, 
                 max_size: int = 1000,
                 default_ttl: Optional[timedelta] = None,
                 strategy: Optional[CacheStrategy[K, V]] = None):
        self.max_size = max_size
        self.default_ttl = default_ttl
        self.strategy = strategy or LRUStrategy[K, V]()
        
        self._cache: Dict[K, CacheEntry[V]] = {}
        self._lock = threading.RLock()
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        self.stats = {
            "hits": 0,
            "misses": 0,
            "evictions": 0
        }
    
    def get(self, key: K) -> Optional[V]:
        """–ü–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –∫—ç—à–∞"""
        with self._lock:
            entry = self._cache.get(key)
            
            if entry is None:
                self.stats["misses"] += 1
                return None
            
            if entry.is_expired():
                del self._cache[key]
                if hasattr(self.strategy, 'remove_key'):
                    self.strategy.remove_key(key)
                self.stats["misses"] += 1
                return None
            
            # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            self._cache[key] = entry.with_hit()
            if hasattr(self.strategy, 'record_access'):
                self.strategy.record_access(key)
            
            self.stats["hits"] += 1
            return entry.value
    
    def put(self, key: K, value: V, ttl: Optional[timedelta] = None) -> None:
        """–î–æ–±–∞–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –∫—ç—à"""
        with self._lock:
            # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è
            expires_at = None
            if ttl or self.default_ttl:
                expires_at = datetime.now() + (ttl or self.default_ttl)
            
            entry = CacheEntry(
                value=value,
                created_at=datetime.now(),
                expires_at=expires_at
            )
            
            self._cache[key] = entry
            if hasattr(self.strategy, 'record_access'):
                self.strategy.record_access(key)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —É–¥–∞–ª–µ–Ω–∏—è
            self._evict_if_needed()
    
    def _evict_if_needed(self) -> None:
        """–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏"""
        keys_to_remove = []
        
        for key, entry in self._cache.items():
            if self.strategy.should_evict(key, entry, 
                                        len(self._cache), self.max_size):
                keys_to_remove.append(key)
        
        for key in keys_to_remove:
            del self._cache[key]
            if hasattr(self.strategy, 'remove_key'):
                self.strategy.remove_key(key)
            self.stats["evictions"] += 1
    
    def clear(self) -> None:
        """–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à"""
        with self._lock:
            self._cache.clear()
            if hasattr(self.strategy, 'access_times'):
                self.strategy.access_times.clear()
    
    def size(self) -> int:
        """–†–∞–∑–º–µ—Ä –∫—ç—à–∞"""
        return len(self._cache)
    
    def hit_ratio(self) -> float:
        """–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ø–æ–ø–∞–¥–∞–Ω–∏–π"""
        total = self.stats["hits"] + self.stats["misses"]
        return self.stats["hits"] / total if total > 0 else 0.0

# –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π
def cached(cache: Cache[str, Any], 
          ttl: Optional[timedelta] = None) -> Callable:
    """–î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π"""
    
    def decorator(func: Callable) -> Callable:
        def wrapper(*args, **kwargs):
            # –°–æ–∑–¥–∞–µ–º –∫–ª—é—á –∫—ç—à–∞
            cache_key = f"{func.__name__}:{hash(str(args) + str(sorted(kwargs.items())))}"
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
            cached_result = cache.get(cache_key)
            if cached_result is not None:
                return cached_result
            
            # –í—ã—á–∏—Å–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            result = func(*args, **kwargs)
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à
            cache.put(cache_key, result, ttl)
            
            return result
        
        return wrapper
    return decorator
```

### –°–∏—Å—Ç–µ–º–∞ —Å–æ–±—ã—Ç–∏–π —Å —Ç–∏–ø–∏–∑–∞—Ü–∏–µ–π

```python
from typing import TypeVar, Generic, Callable, Dict, List, Any
from dataclasses import dataclass
from datetime import datetime
from abc import ABC, abstractmethod
import asyncio
from enum import Enum

# –¢–∏–ø—ã —Å–æ–±—ã—Ç–∏–π
EventType = TypeVar('EventType')
EventData = TypeVar('EventData')

@dataclass(frozen=True)
class Event(Generic[EventData]):
    """–¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ"""
    type: str
    data: EventData
    timestamp: datetime = datetime.now()
    source: str = "unknown"
    correlation_id: Optional[str] = None
    
    def with_correlation_id(self, correlation_id: str) -> 'Event[EventData]':
        """–°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ —Å correlation ID"""
        return Event(
            type=self.type,
            data=self.data,
            timestamp=self.timestamp,
            source=self.source,
            correlation_id=correlation_id
        )

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
EventHandler = Callable[[Event[EventData]], None]
AsyncEventHandler = Callable[[Event[EventData]], Awaitable[None]]

class EventBus(Generic[EventData]):
    """–¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏–Ω–∞ —Å–æ–±—ã—Ç–∏–π"""
    
    def __init__(self):
        self._handlers: Dict[str, List[EventHandler[EventData]]] = {}
        self._async_handlers: Dict[str, List[AsyncEventHandler[EventData]]] = {}
        self._middleware: List[Callable[[Event[EventData]], Event[EventData]]] = []
        
    def subscribe(self, event_type: str, 
                 handler: EventHandler[EventData]) -> None:
        """–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è"""
        if event_type not in self._handlers:
            self._handlers[event_type] = []
        self._handlers[event_type].append(handler)
    
    def subscribe_async(self, event_type: str, 
                       handler: AsyncEventHandler[EventData]) -> None:
        """–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)"""
        if event_type not in self._async_handlers:
            self._async_handlers[event_type] = []
        self._async_handlers[event_type].append(handler)
    
    def unsubscribe(self, event_type: str, 
                   handler: EventHandler[EventData]) -> None:
        """–û—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç —Å–æ–±—ã—Ç–∏–π"""
        if event_type in self._handlers:
            try:
                self._handlers[event_type].remove(handler)
            except ValueError:
                pass
    
    def add_middleware(self, 
                      middleware: Callable[[Event[EventData]], Event[EventData]]) -> None:
        """–î–æ–±–∞–≤–∏—Ç—å middleware"""
        self._middleware.append(middleware)
    
    def publish(self, event: Event[EventData]) -> None:
        """–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ"""
        # –ü—Ä–∏–º–µ–Ω—è–µ–º middleware
        processed_event = event
        for middleware in self._middleware:
            processed_event = middleware(processed_event)
        
        # –£–≤–µ–¥–æ–º–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
        handlers = self._handlers.get(processed_event.type, [])
        for handler in handlers:
            try:
                handler(processed_event)
            except Exception as e:
                print(f"–û—à–∏–±–∫–∞ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ —Å–æ–±—ã—Ç–∏—è: {e}")
    
    async def publish_async(self, event: Event[EventData]) -> None:
        """–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ"""
        # –ü—Ä–∏–º–µ–Ω—è–µ–º middleware
        processed_event = event
        for middleware in self._middleware:
            processed_event = middleware(processed_event)
        
        # –£–≤–µ–¥–æ–º–ª—è–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
        self.publish(processed_event)
        
        # –£–≤–µ–¥–æ–º–ª—è–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
        async_handlers = self._async_handlers.get(processed_event.type, [])
        if async_handlers:
            tasks = [handler(processed_event) for handler in async_handlers]
            await asyncio.gather(*tasks, return_exceptions=True)

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–∏–ø—ã —Å–æ–±—ã—Ç–∏–π
@dataclass
class UserEvent:
    """–°–æ–±—ã—Ç–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    user_id: int
    action: str
    details: Dict[str, Any]

@dataclass
class SystemEvent:
    """–°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è"""
    component: str
    level: str
    message: str
    metadata: Dict[str, Any]

# –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —à–∏–Ω—ã —Å–æ–±—ã—Ç–∏–π
UserEventBus = EventBus[UserEvent]
SystemEventBus = EventBus[SystemEvent]

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
def create_event_system():
    """–°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —Å–æ–±—ã—Ç–∏–π"""
    
    # –°–æ–∑–¥–∞–µ–º —à–∏–Ω—ã —Å–æ–±—ã—Ç–∏–π
    user_bus = UserEventBus()
    system_bus = SystemEventBus()
    
    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π
    def handle_user_login(event: Event[UserEvent]) -> None:
        print(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {event.data.user_id} –≤–æ—à–µ–ª –≤ —Å–∏—Å—Ç–µ–º—É")
    
    def handle_user_logout(event: Event[UserEvent]) -> None:
        print(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {event.data.user_id} –≤—ã—à–µ–ª –∏–∑ —Å–∏—Å—Ç–µ–º—ã")
    
    # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    async def log_user_activity(event: Event[UserEvent]) -> None:
        # –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–ø–∏—Å–∏ –≤ –ë–î
        await asyncio.sleep(0.1)
        print(f"–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {event.data.user_id} –∑–∞–ø–∏—Å–∞–Ω–∞ –≤ –ë–î")
    
    # –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è
    user_bus.subscribe("user.login", handle_user_login)
    user_bus.subscribe("user.logout", handle_user_logout)
    user_bus.subscribe_async("user.login", log_user_activity)
    user_bus.subscribe_async("user.logout", log_user_activity)
    
    # Middleware –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    def logging_middleware(event: Event[UserEvent]) -> Event[UserEvent]:
        print(f"[LOG] –°–æ–±—ã—Ç–∏–µ: {event.type} –≤ {event.timestamp}")
        return event
    
    user_bus.add_middleware(logging_middleware)
    
    return user_bus, system_bus
```

–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ Python, –≤–∫–ª—é—á–∞—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —è–∑—ã–∫–∞, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏ –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–∏–ø–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞–¥–µ–∂–Ω–æ–≥–æ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–≥–æ –∫–æ–¥–∞. 